---
title: The Anatomy of the UBOS Personal Data Mesh web application
breadcrumbtitle: Anatomy of the web application
weight: 10
---

## Overview

The {{% gl mesh %}} has many components; its most important one is the
web application through which the user interacts with their personal
data. Here we describe its overall structure.

## A daemon behind Apache

When a device running the {{% gl mesh %}} web application receives an
incoming HTTP request, this HTTP request is handled by the Apache web
server (which acts as a [reverse proxy](https://httpd.apache.org/docs/2.4/howto/reverse_proxy.html)).

This has several reasons, including:

* it enables the user run run additional web applications on the same
  device, such as at different virtual hostnames;
* SSL/TLS certificate management can be performed using Apache, including,
  for example, automatic Letsencrypt certificate renewals.

This reverse proxy configuration is set up automatically by {{% gl linux %}}
when the {{% gl mesh %}} is {{% gl deployment deployed %}}.

The actual {{% gl mesh %}} daemon is a [systemd](https://systemd.io/) service,
created with the Apache Commons
[JSVC framework](https://commons.apache.org/proper/commons-daemon/jsvc.html).
This framework was specifically created for long-running Java daemons, such
as this one.

The {{% gl mesh %}} systemd service is usually called `diet4j-jsvc@<NNNN>.service`,
where `<<NNNN>>` is a random hex number (the {{% gl AppConfigId %}})
of the {{% gl linux %}} {{% gl AppConfiguration %}}).
To check whether it is running:

```
% sudo systemctl | grep diet4j
```

and, with the appropriate `<NNNN>`:
```
% system systemctl status diet4j-jsvc@<NNNN>.service
```

## The diet4j module framework

The {{% gl mesh %}} uses the [diet4j](https://diet4j.org) java module framework.
This makes it possible to develop, and deploy, and run, the {{% gl mesh %}} in
a modular fashion that is more suitable for the {{% gl mesh %}} requirements
than other module frameworks (like [OSGI](https://en.wikipedia.org/wiki/OSGi)).

The systemd service configuration invokes the JSVC excutable, which then
runs diet4j's "main program" for JSVC services in class `org.diet4j.jsvc.Diet4jDaemon`.
You can see this in the `ExecStart` section of the systemd service file:

```
% systemctl cat diet4j-jsvc@.service
```
which contains the snippet:
```
ExecStart=/usr/bin/jsvc \
        ...
        -cp /usr/lib/java/org/diet4j/diet4j-jsvc/${DIET4J_VERSION}/diet4j-jsvc-${DIET4J_VERSION}.jar \
        ...
        org.diet4j.jsvc.Diet4jDaemon \
        $DIET4J_ARGS
```

The diet4j module framework, in turn, follows the instructions in file
`/etc/diet4j/diet4j-jsvc-<NNNN>.env`, which define a few environment variables,
but also the main diet4j properties in file
`/etc/diet4j/diet4j-jsvc-<NNNN>/ubos-mesh-underbars-mysql.properties`

If you look at this file, you will some qualified Java properties used to
determine which modules to load, and how to configure them, like this:

```
diet4j!module=net.ubos.underbars.mysql ubos-mesh-model-amazon ubos-mesh-model-facebook
...

net.ubos.underbars.mysql!maindbname=gmimfxladhkoqswy
```

The first name listed in `diet4j!module` (here: `net.ubos.underbars.mysql`) is the
main module to activate, while the remainder of the names listed in the same
property are additional modules to activate.

In {{% gl linux %}} terms, that makes `net.ubos.underbars.mysql` the {{% gl app %}},
and the other modules {{% gls accessory %}}. And indeed, this entire `.env` file is
being generated during {{% gl deployment %}} of the {{% gl mesh %}}
on the user's device, from the information entered in `ubos-admin createsite`
or the provided {{% gl site_json %}} file.

The other property shown in the fragment above is the name of the main
MySQL database to be used by this instance of the {{% gl mesh %}}.
This name is random, and changes, as it is automatically generated by
{{% gl linux %}} during {{% gl deployment %}}.

## What's the right Site JSON file to use with the {{% gl mesh %}}?

There is no one "right" {{% gl site_json %}} file,
as you can configure as few or as many {{% gls accessory %}}
({{% gls model %}}, {{% gls Viewlet %}} etc) as you like; and depending on what
you want to debug, for example, you may very well switch between different
configurations.

[Here is a link](https://gitlab.com/ubos/demo-ubos-mesh/-/blob/main/UBOS-STAFF/site-templates/site.json)
to the {{% gl site_json %}} we created for
{{% pageref "/docs/developers/tutorials-mesh" %}}.

To deploy the {{% gl mesh %}} in this configuration, download this file as
`site.json` and then deploy it as a template like this:

```
sudo ubos-admin deploy --file site.json --template --verbose
```

or boot the Docker container for the tutorial as described; this
very {{% gl site_json %}} file will be deployed automatically during boot.
